<script src="../../components/page/page.js"></script>
<link rel="import" href="../../components/polymer/polymer.html">
<polymer-element name="x-router" attributes="for">
	<template>
  <style>
    :host {
      display: none;
    }
  </style>

  <content select="x-route"></content>

  </template>
  <script>
    Polymer('x-router', {

      ready: function () {
        this.container = document.getElementById(this.for);
        this.routes = this.querySelectorAll('x-route').array();
        this.routes.forEach(function (route) {
          var path = route.getAttribute('path');
          var page_name = route.getAttribute('page');
          page(path, this.open(page_name));
        }, this);

        this.container.addEventListener('click-link', this.on_click_link);
        page();
      },

      on_click_link: function (event) {
        var url = event.detail;
        page.show(url);
      },

      open: function (page_name) {
        var container = this.container;
        return function (context) {
          var params = context.params;
          var property;
          var element = document.createElement(page_name);
          for (property in params) {
            if (isNaN(property)) {
              element.setAttribute(property, params[property]);
            }
          }
          context.element = element;
          while (container.firstChild) container.removeChild(container.firstChild);
          container.appendChild(element);
          scroll(0,0);
        };
      }

    });
  </script>
</polymer-element>