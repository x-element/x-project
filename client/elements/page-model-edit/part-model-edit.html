<link rel="import" href="/components/polymer/polymer.html">   
<link rel="import" href="/components/iron-ajax/iron-ajax.html">
<link rel="import" href="../api-get-schema/api-get-schema.html">
<link rel="import" href="../input-checkbox/input-checkbox.html">
<link rel="import" href="../input-date/input-date.html">
<link rel="import" href="../input-email/input-email.html">
<link rel="import" href="../input-enum/input-enum.html">
<link rel="import" href="../input-money/input-money.html">
<link rel="import" href="../input-number/input-number.html">
<link rel="import" href="../input-password/input-password.html">
<link rel="import" href="../input-select/input-select.html">
<link rel="import" href="../input-string/input-string.html">
<link rel="import" href="../input-text/input-text.html">
<link rel="import" href="../input-url/input-url.html">
<dom-module id="part-model-edit">
  <style>
    :host {
      display: block;
    }
  </style>
  <template>

    <form role="form" id="form"></form>

  </template>
</dom-module>
<script>
  Polymer({

    is: 'part-model-edit',

    edit: true,

    form: {},

    properties: {
      schema: {
        type: Object,
        observer: 'on_change_schema'
      },
      model: {
        type: Object
      }
    },

    on_change_schema: function () {
      this.create_form(this.schema);
    },

    types: {
      "string": "input-string",
      "select": "input-select",
      "date": "input-date",
      "enum": "input-enum",
      "number": "input-number",
      "email": "input-email",
      "text": "input-text",
      "url": "input-url",
      "boolean": "input-checkbox",
      "money": "input-money",
      "password": "input-password"
    },

    create_form: function (schema) {
      if (!schema.properties) return;
      schema.properties.forEach(this.create_form_element, this);
    },

    create_form_element: function (property) {
      var type = property.$type;
      var element_type = this.types[type] || 'input-string';
      var element = document.createElement(element_type);
      element.property = property;
      this.$.form.appendChild(element);
      this.form[property.name] = element;
    },

    get values () {
      var values = {};
      var name;
      var value;
      var element;
      var form = this.form;
      for (name in form) {
        element = form[name];
        value = element.value;
        values[name] = value;
      }
      return values;
    },

    set values (values) {
      var form = this.form;
      var name;
      var value;
      var element;
      for (name in form) {
        value = values[name];
        if (value) {
          element = form[name];
          element.value = value;
        }
      }
      return this;
    }

  });
</script>