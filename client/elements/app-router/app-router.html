<link rel="import" href="/components/polymer/polymer.html">   
<dom-module id="app-router">
  <style>
    :host {
      display: none;
    }
  </style>
  <template>
    <content select="app-route"></content>
  </template>
</dom-module>
<script src="../../components/page/page.js"></script>
<script>
  Polymer({

    is: 'app-router',

    properties: {
      appId: String
    },

    ready: function () {
      this.container = document.getElementById('app');
      var routes = this.querySelectorAll('app-route')
      this.routes = Array.prototype.slice.call(routes);
      this.routes.forEach(function (route) {
        var path = route.getAttribute('path');
        var page_name = route.getAttribute('page');
        page(path, this.open(page_name));
      }, this);

      this.container.addEventListener('click-link', this.on_click_link);
      page();
    },

    on_click_link: function (event) {
      var url = event.detail;
      page.show(url);
    },

    open: function (page_name) {
      var container = this.container;
      return function (context) {
        var params = context.params;
        var property;
        var element = document.createElement(page_name);
        for (property in params) {
          if (isNaN(property)) {
            element.setAttribute(property, params[property]);
          }
        }
        context.element = element;
        while (container.firstChild) container.removeChild(container.firstChild);
        container.appendChild(element);
        scroll(0,0);
      };
    }

  });
</script>