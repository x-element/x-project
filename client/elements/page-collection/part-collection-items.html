<link rel="import" href="../../components/core-ajax/core-ajax.html">
<link rel="import" href="../../components/x-link/x-link.html">
<link rel="import" href="part-collection-item.html">
<polymer-element name="part-collection-items">
  <template>
    <style>
      :host {
        display: block;
      }
    </style>

    <core-ajax id="ajax" url="/api/{{ schema.plural }}" handleAs="json" 
      on-core-response="{{Â on_response }}" on-core-error="{{ on_error }}"></core-ajax>

    <div class="form-group">
      <a class="btn btn-success" href="/admin/collections/{{ schema.plural }}/create">insert new</a>
    </div>
    <ol>
      <template repeat="{{ item, index in items }}">
        <template if="{{ item }}">
          <li>
            <part-collection-item item="{{ item }}" index="{{ index }}" schema="{{ schema }}"
              on-delete="{{ on_delete_item }}"></part-collection-item>
          </li>
        </template>
      </template>
    </ol>

  </template>
  <script>
    Polymer('part-collection-items', {

      schema: {},

      schemaChanged: function () {
        this.$.ajax.go();
      },

      on_response: function(event) {
        var response = event.detail.response;
        this.items = response;
      },

      on_error: function (event) {

      },

      on_delete_item: function (event) {
        var index = event.detail.index;
        this.items.splice(index, 1);
      }

    });
  </script>
</polymer-element>