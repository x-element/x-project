<link rel="import" href="/components/polymer/polymer.html">
<link rel="import" href="../part-header/part-header.html">
<link rel="import" href="../part-footer/part-footer.html">
<link rel="import" href="../api-get-schema/api-get-schema.html">
<link rel="import" href="../api-get-collection/api-get-collection.html">
<link rel="import" href="../part-pages/part-pages.html">
<link rel="import" href="part-collection-create.html">
<link rel="import" href="part-collection-items.html">
<link rel="import" href="part-collection-order.html">
<link rel="import" href="part-collection-filter.html">
<dom-module id="page-collection">
  <style>
    :host {
      display: block;
    }

    #advanced {
      background-color: #f8f8f8;
      padding: 10px;
      margin-bottom: 12px;
    }
  </style>
  <template>

    <api-get-schema id="get_schema" name="{{collection_name}}" 
      schema="{{schema}}"></api-get-schema>

    <api-get-collection id="get_collection" name="{{schema.plural}}" 
      where="{{where}}" order="{{order}}" page="{{page}}" perpage="{{perpage}}"
      collection="{{collection}}" count="{{count}}"></api-get-collection>

    <part-header></part-header>    
    <div class="page container">

      <a is="app-link" href="/admin/collections">Back</a>
      <h1>{{collection_name}}</h1>
      
      <part-collection-create 
        schema="{{schema}}"></part-collection-create>

      <div id="advanced">
        <h4>filter</h4>
        <part-collection-filter id="filter"
          items="{{schema.properties}}" 
          where="{{where}}"></part-collection-filter>

        <h4>order</h4>
        <part-collection-order 
          schema="{{schema}}" 
          order="{{order}}"></part-collection-order>

        <button class="btn btn-sm btn-default" on-click="search">search</button>
      </div>

      <part-collection-items 
        schema="{{schema}}" collection="{{collection}}"></part-collection-items>

      <part-pages 
        count="{{count}}" perpage="{{perpage}}" 
        current="{{page}}"></part-pages>
   
    </div>
    <part-footer></part-footer>

  </template>
</dom-module>
<script>
  Polymer({

    is: 'page-collection',

    properties: {
      collection_name: {
        type: String
      },
      collection: {
        type: Array
      },
      count: {
        type: Number
      },
      schema: {
        type: Object
      },
      where: {
        type: Object
      },
      order: {
        type: String
      },
      page: {
        type: Number,
        value: 0
      },
      perpage: {
        type: Number
      }
    },

    search: function () {
      this.where = this.$.filter.query;
      console.log(this.where, this.order, this.page, this.perpage);
      this.$.get_collection.update();
    }

  });
</script>