<link rel="import" href="/components/polymer/polymer.html">   
<dom-module id="part-login-form">
  <style>
    :host {
      display: block;
    }

    #form {
      width: 300px;
      margin: 0 auto;
    }
  </style>
  <template>
    <iron-ajax id="ajax" method="POST" handleAs="json" contentType="application/json" url="/api/Users/login"
      on-core-response="{{on_success}}" on-core-error="{{on_error}}"></iron-ajax>

    <form id="form" on-submit="{{on_submit}}">
      <h3 class="text-center">Login</h3>
      <div class="form-group">
        <label>email</label>
        <input id="email" type="text" class="form-control" placeholder="email" value="">
      </div>
      <div class="form-group">
        <label>password</label>
        <input id="password" type="password" class="form-control" placeholder="password" value="">
      </div>
      <input type="submit" class="btn btn-success" on-click="on_submit" value="login" />
    </form>
  </template>
</dom-module>
<script>
  Polymer({

    is: 'part-login-form',

    ready: function () {
      this.$.email.value = 'a@b.com';
      this.$.password.value = '123';
    },

    on_submit: function (event) {
      event.preventDefault();
      var credentials = {};
      var input = this.$.email.value;
      var pw = this.$.password.value;
      var ttl = "120960000";
      credentials.email =  input;
      credentials.password = pw;
      credentials.ttl = ttl;
      var body = JSON.stringify(credentials);
      var login = this.$.login;
      login.body = body;
      login.go();
    },

    on_success: function(event) {
      var response = event.detail.response;
      var body = JSON.parse(response);
      this.fire('logged', body.id);
      page("/collections");
    },

    on_error: function (event) {
      this.fire('logged', false);
      alert("username or password not valid");
    }

  });
</script>